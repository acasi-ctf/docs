<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Acasi CTF</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">2.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="developing.html"><strong aria-hidden="true">3.</strong> Developing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developing_win.html"><strong aria-hidden="true">3.1.</strong> Windows</a></li><li class="chapter-item expanded "><a href="developing_mac.html"><strong aria-hidden="true">3.2.</strong> macOS</a></li></ol></li><li class="chapter-item expanded "><a href="challenges.html"><strong aria-hidden="true">4.</strong> Challenges</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="creating_challenges.html"><strong aria-hidden="true">4.1.</strong> Creating</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Acasi CTF</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>NOTE: This documentation is still a work-in-progress!</strong></p>
<h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p><img src="images/k8s-overview.png" alt="Kubernetes overview" />
<img src="images/start-challenge-seq-diagram.png" alt="Start challenge sequence diagram" /></p>
<h1 id="developing"><a class="header" href="#developing">Developing</a></h1>
<ul>
<li><a href="developing_win.html">Windows</a></li>
<li><a href="developing_mac.html">macOS</a></li>
</ul>
<h1 id="developing-on-windows"><a class="header" href="#developing-on-windows">Developing on Windows</a></h1>
<p>This guide will introduce you to deploying and working on the Acasi CTF platform on Windows by
utilizing WSL 2 + Docker Desktop.</p>
<h1 id="install-wsl-2-and-docker-desktop"><a class="header" href="#install-wsl-2-and-docker-desktop">Install WSL 2 and Docker Desktop</a></h1>
<p>As WSL 2 and Docker Desktop are commercial products, there is quite extensive documentation on how
to install both of these available on their respective websites. The appropriate links are provided
below. </p>
<p><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10#manual-installation-steps">Install WSL 2</a></p>
<p><a href="https://docs.docker.com/docker-for-windows/install/">Install Docker Desktop</a></p>
<h1 id="configure-docker-desktop"><a class="header" href="#configure-docker-desktop">Configure Docker Desktop</a></h1>
<h2 id="enable-wsl-2-backend"><a class="header" href="#enable-wsl-2-backend">Enable WSL 2 Backend</a></h2>
<p>To use Docker from within our WSL 2 virtual machine, we need to enable the WSL 2 based engine from
within Docker Desktop. From the main Docker Desktop window, click the settings gear and check the
&quot;Use the WSL 2 based engine&quot; option.</p>
<p><img src="images/docker_wsl2_step1.png" alt="Enable the WSL 2 Docker Engine" /></p>
<p>Additionally, navigate to &quot;Resources&quot;, then to &quot;WSL Integration&quot;. Check both the &quot;Enable integration
with my default WSL distro&quot;, and the &quot;Ubuntu-20.04&quot; slider.</p>
<p><img src="images/docker_wsl2_step2.png" alt="Enable Docker WSL Integration" /></p>
<p>After both of these steps have been taken, click the &quot;Apply &amp; Restart&quot; button.</p>
<h2 id="add-hosts-entry"><a class="header" href="#add-hosts-entry">Add hosts entry</a></h2>
<p>As an administrator, we need to add an entry to our local hosts file so that the &quot;ctf&quot; domain
directs to our local web server. Microsoft really enjoys hiding files deep inside the Windows
directory, the specific file we're looking for is <code>C:\Windows\system32\drivers\etc\hosts</code>.</p>
<p>The contents we want to add are as follows, do not remove anything from the file.</p>
<pre><code>127.0.0.1 ctf
</code></pre>
<h3 id="visual-studio-code"><a class="header" href="#visual-studio-code">Visual Studio Code</a></h3>
<p>If you have Visual Studio Code installed, open the file in there, and Code will ask if you want to
escalate privileges in order to save the file.</p>
<p><img src="images/windows_etc_hosts.png" alt="Visual Studio Code editing hosts file" /></p>
<h3 id="notepad"><a class="header" href="#notepad">Notepad</a></h3>
<p>If you don't have Visual Studio Code installed, run Notepad as administrator. Open the hosts file
and add the changes, then save it.</p>
<h1 id="install-kubernetes-utilities"><a class="header" href="#install-kubernetes-utilities">Install Kubernetes utilities</a></h1>
<p>The following script will download and install a few utilities that we are going to use in the rest
of this guide and for development on the platform.</p>
<pre><code>curl https://raw.githubusercontent.com/acasi-ctf/docs/main/scripts/install-k8s-deps.sh | bash
</code></pre>
<h1 id="configure-wsl-2"><a class="header" href="#configure-wsl-2">Configure WSL 2</a></h1>
<h2 id="create-wsl-user"><a class="header" href="#create-wsl-user">Create WSL user</a></h2>
<p>In your WSL prompt, run the following, substituting USERNAME for the username of your choosing.</p>
<pre><code># Add new user
useradd -m USERNAME

# Set your user password
passwd USERNAME

# Add yourself to the sudo group
gpasswd --add USERNAME sudo
</code></pre>
<p>Edit /etc/wsl.conf and insert the following contents, substituting USERNAME with your chosen
username from the prior step.</p>
<pre><code>[user]
default=USERNAME

[interop]
appendWindowsPath=false
</code></pre>
<p>After applying this configuration, open a PowerShell window, run this WSL command and then reopen
your WSL shell, as this will force it to stop.</p>
<pre><code>wsl --shutdown
</code></pre>
<h2 id="configure-minikube"><a class="header" href="#configure-minikube">Configure minikube</a></h2>
<pre><code>minikube config set driver docker
minikube start
</code></pre>
<h2 id="add-bitnami-helm-repo"><a class="header" href="#add-bitnami-helm-repo">Add Bitnami Helm repo</a></h2>
<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami
</code></pre>
<h2 id="install-ingress-controller"><a class="header" href="#install-ingress-controller">Install Ingress controller</a></h2>
<p>An ingress controller gives us the ability to run one web server which will proxy to one or more
backend servers, allowing us to share a single hostname between those multiple backend servers.</p>
<pre><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.48.1/deploy/static/provider/cloud/deploy.yaml
</code></pre>
<h1 id="clone-and-build-source"><a class="header" href="#clone-and-build-source">Clone and build source</a></h1>
<h2 id="clone-source"><a class="header" href="#clone-source">Clone source</a></h2>
<pre><code># Clone source from Git using SSH
git clone git@github.com:acasi-ctf/ctf.git

# Alternatively, use HTTPS if you don't have an SSH key installed
git clone https://github.com/acasi-ctf/ctf.git
</code></pre>
<p><strong>Temporary step: check out dev_docs_branch</strong></p>
<pre><code>cd ctf
git checkout dev_docs
</code></pre>
<h2 id="build-docker-images"><a class="header" href="#build-docker-images">Build Docker images</a></h2>
<p>Now, build the Docker images for the platform. Ensure you're in the directory of the ctf repository.</p>
<pre><code># Activate the Docker environment
eval $(minikube -p minikube docker-env)

# Build docker images
make docker
</code></pre>
<h1 id="deploy"><a class="header" href="#deploy">Deploy</a></h1>
<h2 id="create-namespace"><a class="header" href="#create-namespace">Create namespace</a></h2>
<p>Kubernetes namespaces are a method of isolating resources, and is good practice to keep separate
projects in different namespaces for this reason.</p>
<pre><code># Create ctf namespace
kubectl create ns ctf

# Switch to new namespace
kubens ctf
</code></pre>
<h2 id="create-and-deploy-manifests"><a class="header" href="#create-and-deploy-manifests">Create and deploy manifests</a></h2>
<pre><code>cd deploy

./generate_ssh_keys.sh minikube
cd minikube
helm install postgres bitnami/postgresql --values postgres-values.yaml
cd ..

kustomize build minikube &gt; minikube.yaml
kubectl apply -f minikube.yaml
</code></pre>
<h2 id="migrate-the-database"><a class="header" href="#migrate-the-database">Migrate the database</a></h2>
<p><strong>This is a potential task for improvement.</strong></p>
<p>Currently, we need to manually migrate the PostgreSQL database. This is a fairly simple procedure,
but ideally would be automated in the future.</p>
<p>We need to get a shell for the pod that runs the frontend API. List the pods running in the ctf
namespace like so.</p>
<pre><code>☁  ~  kubectl get pods
NAME                                         READY   STATUS        RESTARTS   AGE
ctf-frontend-584b4b9874-26vxx                1/1     Running       0          31d
ctf-operator-759457f978-d4q76                1/1     Running       0          31d
ctf-termproxy-69dc5c48cf-2pcl9               1/1     Running       0          31d
ctf-ui-dd5c4476b-lbc28                       1/1     Running       0          31d
postgres-postgresql-0
</code></pre>
<p>Locate the pod that starts with <code>ctf-frontend</code>. Make a note of the full name, in our case it is
<code>ctf-frontend-584b4b9874-26vxx</code>. Execute a bash shell in the pod and run the commands as provided.</p>
<pre><code>☁  ~  kubectl exec -it ctf-frontend-584b4b9874-26vxx -- /bin/bash
root@ctf-frontend-584b4b9874-26vxx:/app# cd frontend
root@ctf-frontend-584b4b9874-26vxx:/app/frontend# flask db upgrade
[...]
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -&gt; 6e85efd406c7, Initial migrations
INFO  [alembic.runtime.migration] Running upgrade 6e85efd406c7 -&gt; 5213f9e65a8c, Add documentation table and minor adjustments
root@ctf-frontend-f7f4f445f-8tzkr:/app/frontend# exit
</code></pre>
<p>If you see at least a couple of <code>Running upgrade</code> lines, the migration succeeded.</p>
<h2 id="accessing-the-ui"><a class="header" href="#accessing-the-ui">Accessing the UI</a></h2>
<p>To access the UI, we need to enable the minikube tunnel. In your WSL shell, run <code>minikube tunnel</code>.
It should be noted that you will need to have the tunnel running during any development work, it is
not a permanent operation. You should see output similar to the following, requiring your sudo
password.</p>
<pre><code>☁  ~  minikube tunnel
❗  The service ingress-nginx-controller requires privileged ports to be exposed: [80 443]
🔑  sudo permission will be asked for it.
🏃  Starting tunnel for service ingress-nginx-controller.
[sudo] password for lgorence:
</code></pre>
<p>The UI should now be accessible from your Windows machine by navigating to https://ctf/. As this is
running locally (nor is it a valid TLD), you will not have a valid SSL certificate, and your browser
will likely require you to accept the security risk. Brave may have issues with this, not allowing
you to bypass the risk.</p>
<h1 id="developing-on-macos"><a class="header" href="#developing-on-macos">Developing on macOS</a></h1>
<p><strong>NOTE: This documentation is still a work-in-progress!</strong></p>
<p>This guide will introduce you to deploying and working on the Acasi CTF platform on macOS by
utilizing minikube.</p>
<p><strong>This guide assumes you are using an Intel Mac, these instructions have not been tested on an Apple
Silicon Mac, yet.</strong></p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>Homebrew</li>
<li>Docker Desktop (optional, read <a href="developing_mac.html#warning-macos-beta-users">this</a>)</li>
<li>Xcode</li>
<li>Xcode Command Line Utilities</li>
</ul>
<h1 id="install-utilities"><a class="header" href="#install-utilities">Install utilities</a></h1>
<pre><code>brew install minikube kubectx kubectl helm kustomize fzf
</code></pre>
<h1 id="start-minikube"><a class="header" href="#start-minikube">Start minikube</a></h1>
<h2 id="warning-macos-beta-users"><a class="header" href="#warning-macos-beta-users">Warning: macOS beta users</a></h2>
<p>If you are running the macOS 12.0 Monterey beta, you may need to use the Docker driver instead of
the HyperKit driver, which is the default. If you do not, you might hit an error where minikube
times out while trying to start the VM. Do this by running the following command before starting it.</p>
<pre><code>minikube config set driver docker
</code></pre>
<h2 id="starting-minikube"><a class="header" href="#starting-minikube">Starting minikube</a></h2>
<p>Start minikube by running the start subcommand.</p>
<pre><code>minikube start
</code></pre>
<h1 id="kubernetes-pre-requisites"><a class="header" href="#kubernetes-pre-requisites">Kubernetes pre-requisites</a></h1>
<h2 id="add-bitnami-helm-repo-1"><a class="header" href="#add-bitnami-helm-repo-1">Add Bitnami Helm repo</a></h2>
<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami
</code></pre>
<h2 id="install-ingress-controller-1"><a class="header" href="#install-ingress-controller-1">Install Ingress controller</a></h2>
<p>An ingress controller gives us the ability to run one web server which will proxy to one or more
backend servers, allowing us to share a single hostname between those multiple backend servers.</p>
<pre><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.48.1/deploy/static/provider/cloud/deploy.yaml
</code></pre>
<h2 id="add-hosts-entry-1"><a class="header" href="#add-hosts-entry-1">Add hosts entry</a></h2>
<p>We need to add an entry to our local hosts file so that the &quot;ctf&quot; domain directs to our local web
server. The hosts files on macOS is located at /etc/hosts. As this is a system file, you must edit
it as an administrator.</p>
<p>The contents we want to add are as follows, do not remove anything from the file.</p>
<pre><code>127.0.0.1 ctf
</code></pre>
<h1 id="clone-and-build-source-1"><a class="header" href="#clone-and-build-source-1">Clone and build source</a></h1>
<h2 id="clone-source-1"><a class="header" href="#clone-source-1">Clone source</a></h2>
<pre><code># Clone source from Git using SSH
git clone git@github.com:acasi-ctf/ctf.git

# Alternatively, use HTTPS if you don't have an SSH key installed
git clone https://github.com/acasi-ctf/ctf.git
</code></pre>
<p><strong>Temporary step: check out dev_docs_branch</strong></p>
<pre><code>cd ctf
git checkout dev_docs
</code></pre>
<h2 id="build-docker-images-1"><a class="header" href="#build-docker-images-1">Build Docker images</a></h2>
<p>Now, build the Docker images for the platform. Ensure you're in the directory of the ctf repository.</p>
<pre><code># Activate the Docker environment
eval $(minikube -p minikube docker-env)

# Build docker images
make docker
</code></pre>
<h1 id="deploy-1"><a class="header" href="#deploy-1">Deploy</a></h1>
<h2 id="create-namespace-1"><a class="header" href="#create-namespace-1">Create namespace</a></h2>
<p>Kubernetes namespaces are a method of isolating resources, and is good practice to keep separate
projects in different namespaces for this reason.</p>
<pre><code># Create ctf namespace
kubectl create ns ctf

# Switch to new namespace
kubens ctf
</code></pre>
<h2 id="create-and-deploy-manifests-1"><a class="header" href="#create-and-deploy-manifests-1">Create and deploy manifests</a></h2>
<pre><code>cd deploy

./generate_ssh_keys.sh minikube
cd minikube
helm install postgres bitnami/postgresql --values postgres-values.yaml
cd ..

kustomize build minikube &gt; minikube.yaml
kubectl apply -f minikube.yaml
</code></pre>
<h2 id="migrate-the-database-1"><a class="header" href="#migrate-the-database-1">Migrate the database</a></h2>
<p><strong>This is a potential task for improvement.</strong></p>
<p>Currently, we need to manually migrate the PostgreSQL database. This is a fairly simple procedure,
but ideally would be automated in the future.</p>
<p>We need to get a shell for the pod that runs the frontend API. List the pods running in the ctf
namespace like so.</p>
<pre><code>☁  ~  kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
ctf-frontend-f7f4f445f-bkxtc     1/1     Running   0          4m41s
ctf-operator-7d9868665-95xxh     1/1     Running   0          4m41s
ctf-termproxy-7b9858f47b-6gflw   1/1     Running   0          4m41s
ctf-ui-74d56f8d-dljnz            1/1     Running   0          4m40s
postgres-postgresql-0            1/1     Running   0          5m18s
</code></pre>
<p>Locate the pod that starts with <code>ctf-frontend</code>. Make a note of the full name, in our case it is
<code>ctf-frontend-584b4b9874-26vxx</code>. Execute a bash shell in the pod and run the commands as provided.</p>
<pre><code>☁  ~  kubectl exec -it ctf-frontend-f7f4f445f-bkxtc -- /bin/bash
root@ctf-frontend-f7f4f445f-bkxtc:/app# cd frontend
root@ctf-frontend-f7f4f445f-bkxtc:/app/frontend# flask db upgrade
/usr/local/lib/python3.9/site-packages/flask_sqlalchemy/__init__.py:872: FSADeprecationWarning: SQLALCHEMY_TRACK_MODIFICATIONS adds significant overhead and will be disabled by default in the future.  Set it to True or False to suppress this warning.
  warnings.warn(FSADeprecationWarning(
/usr/local/lib/python3.9/site-packages/jose/backends/cryptography_backend.py:18: CryptographyDeprecationWarning: int_from_bytes is deprecated, use int.from_bytes instead
  from cryptography.utils import int_from_bytes, int_to_bytes
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -&gt; 6e85efd406c7, Initial migrations
INFO  [alembic.runtime.migration] Running upgrade 6e85efd406c7 -&gt; 5213f9e65a8c, Add documentation table and minor adjustments
</code></pre>
<p>If you see at least a couple of <code>Running upgrade</code> lines, the migration succeeded.</p>
<h2 id="accessing-the-ui-1"><a class="header" href="#accessing-the-ui-1">Accessing the UI</a></h2>
<p>To access the UI, we need to enable the minikube tunnel. In your WSL shell, run <code>minikube tunnel</code>.
It should be noted that you will need to have the tunnel running during any development work, it is
not a permanent operation. You should see output similar to the following, requiring your sudo
password.</p>
<pre><code>☁  ~  minikube tunnel
❗  The service ingress-nginx-controller requires privileged ports to be exposed: [80 443]
🔑  sudo permission will be asked for it.
🏃  Starting tunnel for service ingress-nginx-controller.
[sudo] password for lgorence:
</code></pre>
<p>The UI should now be accessible from macOS by navigating to https://ctf/. As this is
running locally (nor is it a valid TLD), you will not have a valid SSL certificate, and your browser
will likely require you to accept the security risk. Brave and Safari may have issues with this, not
allowing you to bypass the risk or certain features not working correctly.</p>
<h1 id="introduction-to-challenges"><a class="header" href="#introduction-to-challenges">Introduction to Challenges</a></h1>
<p>Challenge sets and challenges are the basis of the CTF platform. Challenge sets are groups of
similar challenges, and challenges represent an individual problem or task to be performed by the
user.</p>
<h2 id="challenge-environments"><a class="header" href="#challenge-environments">Challenge environments</a></h2>
<p>A challenge environment is defined as the backend representation of a single instance of a challenge
that a user has created. Environments use containers running on Kubernetes to provide various
services for the user. One such instance might be that a user wants to learn more about a Linux
environment and commands. In this case, the challenge would provide an SSH server that the Termproxy
component connects to and would show this in the user interface as a terminal. Alternatively, it is
also possible for a challenge environment to expose a web server in a similar way, and this may be
used for SQL injection, XSS attacks, etc.</p>
<h2 id="how-do-i-create-a-challenge"><a class="header" href="#how-do-i-create-a-challenge">How do I create a challenge?</a></h2>
<p>See the <a href="creating_challenges.html">creating challenges</a> page for more information on this topic.</p>
<h1 id="creating-challenges"><a class="header" href="#creating-challenges">Creating challenges</a></h1>
<p><strong>NOTE: This documentation is still a work-in-progress!</strong></p>
<p>This article covers the relevant knowledge on how to create a terminal-based challenge. It is
expected that the reader has some familiarity with Linux, Docker and Kubernetes. These skills will
be needed to effectively build, run, and troubleshoot any issues you may have during this process.</p>
<h2 id="building-a-container"><a class="header" href="#building-a-container">Building a container</a></h2>
<p>All challenge environments utilize at least one container running in Kubernetes. Because this
article assumes that the reader wants to create a terminal-based challenge (rather than a web-based
one), you will need to familiarize yourself with the penimage. The penimage is effectively a
preconfigured Docker image of which all of our terminal-based challenges derive from. It utilizes
an Ubuntu 20.04 LTS base. The reason it is recommended to use this is that it preinstalls an OpenSSH 
server with a start script that will inject the public key of the Termproxy microservice.</p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>The following is an example of a simple container which adds some Python scripts.</p>
<pre><code class="language-dockerfile">FROM ghcr.io/acasi-ctf/ctf/penimage:latest

COPY challenges/ciphers/challenges/caesar-cipher/code/Caesar-cipher.py /home/player
COPY challenges/ciphers/challenges/comprehensive-challenge/code/Mixed-Challenge-1.py /home/player
COPY challenges/ciphers/challenges/letter-to-number/code/Letter-to-Number.py /home/player
COPY challenges/ciphers/challenges/morse-code/code/Morse_code.py /home/player
COPY challenges/ciphers/challenges/reverse-cipher/code/Reverse.py /home/player
</code></pre>
<p>As you may notice, the user that is used in the container is <strong>player</strong>, and their home directory is
located at <code>/home/player</code>.</p>
<h2 id="challenge-directory-structure"><a class="header" href="#challenge-directory-structure">Challenge directory structure</a></h2>
<p>To create a challenge set and children challenges, you must have a directory for that dedicated
challenge set. The directory structure might look something like below. Each file is annotated with
a brief comment describing briefly what it is.</p>
<pre><code>challenges/kali/challenge-set.json                           # Challenge set definition (JSON)
challenges/kali/challenges/strings/template.yaml             # Kubernetes CRD (YAML)
challenges/kali/challenges/strings/kubernetes.json           # Kubernetes provisioner (JSON)
challenges/kali/challenges/strings/challenge.json            # Challenge definition (JSON)
challenges/kali/challenges/strings/docs/StringsDocument.md   # Documentation (Markdown)
challenges/kali/challenges/strings/src/lock.cpp              # Source code for challenge (C++)
challenges/kali/challenges/binwalk/template.yaml             # Kubernetes CRD (YAML)
challenges/kali/challenges/binwalk/kubernetes.json           # Kubernetes provisioner (JSON)
challenges/kali/challenges/binwalk/challenge.json            # Challenge definition (JSON)
challenges/kali/challenges/binwalk/docs/BinwalkDocument.md   # Documentation (Markdown)
</code></pre>
<h2 id="challenge-set-definition"><a class="header" href="#challenge-set-definition">Challenge set definition</a></h2>
<p>A challenge set definition contains unique identifiers and human-readable descriptor fields. It also
links to each challenge by the name of the directory.</p>
<h3 id="fields"><a class="header" href="#fields">Fields</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>id</td><td>UUIDv4</td><td>Unique identifier for this challenge set. This MUST be unique amongst all other challenge sets and challenges.</td></tr>
<tr><td>slug</td><td>string</td><td>Unique slug name for this challenge set. This MUST be unique amongst all other challenge sets.</td></tr>
<tr><td>name</td><td>string</td><td>Descriptive name that is displayed in the user interface.</td></tr>
<tr><td>description</td><td>string</td><td>Description of this challenge set displayed in the user interface.</td></tr>
<tr><td>version</td><td>string</td><td>Version of this challenge.</td></tr>
<tr><td>challenges</td><td>array of string</td><td>Array of strings that reference each challenge directory to be included in this challenge set. Use lowercases and dashes for these names.</td></tr>
</tbody></table>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;4040a75a-037c-44c0-b1e2-bdcc6ceaddb0&quot;,
  &quot;slug&quot;: &quot;kali&quot;,
  &quot;name&quot;: &quot;Kali&quot;,
  &quot;description&quot;: &quot;Challenge set that focuses on Kali Linux&quot;,
  &quot;version&quot;: &quot;0.1.0&quot;,
  &quot;challenges&quot;: [
    &quot;strings&quot;,
    &quot;binwalk&quot;
  ]
}
</code></pre>
<h2 id="challenge-definition"><a class="header" href="#challenge-definition">Challenge definition</a></h2>
<p>A challenge definition contains unique identifiers, human-readable descriptor fields, and relevant
information required by the platform to build and start the environment.</p>
<h3 id="fields-1"><a class="header" href="#fields-1">Fields</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>id</td><td>UUIDv4</td><td>Unique identifier for this challenge. This MUST be unique amongst all other challenge sets and challenges.</td></tr>
<tr><td>slug</td><td>string</td><td>Unique slug name for this challenge. This MUST be unique amongst all other challenge.</td></tr>
<tr><td>name</td><td>string</td><td>Descriptive name that is displayed in the user interface.</td></tr>
<tr><td>description</td><td>string</td><td>Description of this challenge set displayed in the user interface.</td></tr>
<tr><td>provisioner</td><td>object</td><td>Object which contains field type, which can be either none or kubernetes. If kubernetes, kubernetes.json will be read as part of the provisioning process.</td></tr>
<tr><td>documentation</td><td>array of object</td><td>Array of objects which contain name and path fields, name is descriptive name for user interface and path is the path relative to the challenge.json file.</td></tr>
</tbody></table>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;0c73d010-b360-4116-ba6f-92dad43c3e57&quot;,
  &quot;slug&quot;: &quot;strings&quot;,
  &quot;name&quot;: &quot;strings&quot;,
  &quot;description&quot;: &quot;This is a challenge that demonstrates strings tool&quot;,
  &quot;provisioner&quot;: {
    &quot;type&quot;: &quot;kubernetes&quot;
  },
  &quot;documentation&quot;: [
    {
      &quot;name&quot;: &quot;StringsDocument&quot;,
      &quot;path&quot;: &quot;docs/StringsDocument.md&quot;
    }
  ]
}
</code></pre>
<h2 id="kubernetes-provisioner"><a class="header" href="#kubernetes-provisioner">Kubernetes provisioner</a></h2>
<p>A challenge which utilizes Kubernetes as a provisioning backend (currently the only one supported),
will require a kubernetes.json file in the same directory as challenge.json.</p>
<h3 id="fields-2"><a class="header" href="#fields-2">Fields</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>templatePath</td><td>UUIDv4</td><td>Relative path to a YAML file containing the EnvironmentTemplate CRD for this challenge.</td></tr>
<tr><td>templateCRDVersion</td><td>string enum</td><td>Version of the template CRD. This currently only has one value, which is v1alpha1. This maps directly to the versions of the CRD in Kubernetes.</td></tr>
</tbody></table>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<pre><code class="language-json">{
  &quot;templatePath&quot;: &quot;template.yaml&quot;,
  &quot;templateCRDVersion&quot;: &quot;v1alpha1&quot;
}
</code></pre>
<h2 id="kubernetes-crd"><a class="header" href="#kubernetes-crd">Kubernetes CRD</a></h2>
<p>A challenge which utilizes Kubernetes as a provisioning backend will require this environment
template kind of resource. It combines the specs for one or more pods, and zero or more services and
ingresses.</p>
<h3 id="example-4"><a class="header" href="#example-4">Example</a></h3>
<pre><code class="language-yaml">apiVersion: ctf.acasi.info/v1alpha1
kind: EnvTemplate
metadata:
  name: kali-strings
spec:
  pods:
    - metadata:
        name: penimage
        labels:
          app: penimage
      spec:
        containers:
          - name: penimage
            image: ghcr.io/acasi-ctf/challenges/kali/strings:latest
  services:
    - metadata:
        name: penimage-termproxy
      spec:
        selector:
          app: penimage
        ports:
          - port: 22
            ctfExpose: Termproxy
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
